(this["webpackJsonpexistential-graphs"]=this["webpackJsonpexistential-graphs"]||[]).push([[0],{69:function(t,e,n){},72:function(t,e,n){},76:function(t,e,n){},80:function(t,e,n){},86:function(t,e,n){},87:function(t,e,n){},88:function(t,e,n){},89:function(t,e,n){},90:function(t,e,n){},91:function(t,e,n){},92:function(t,e,n){},94:function(t,e,n){"use strict";n.r(e);var i=n(65),a=n.n(i),r=n(36),s=n(16),o=n(17),l=n(22),c=n(21),h=n(9),u=n.n(h),d=(n(76),n.p,n(69),n(3));function p(t){var e="\n    .cls-1{\n      fill:#ed6b4d;\n      stroke:#e2f3f7;\n      stroke-miterlimit:10;\n      stroke-width:12px;\n    }\n    .cls-2 {\n      fill:#e2f3f7;\n    }\n  ",n={"./MenuIcons/logo.png":Object(d.jsxs)("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 841.23 762.74",width:"8vh",height:"8vh",children:[Object(d.jsx)("defs",{children:Object(d.jsx)("style",{children:e})}),Object(d.jsx)("path",{class:"cls-1",d:"M1022,769v96.74q0,19.28-3.79,30.81a49,49,0,0,1-13.94,20.83q-10.17,9.28-26,17.9Q932.46,960,890.12,971.41t-92.27,11.36q-58.17,0-106-17.91t-81.58-52q-33.75-34.08-51.81-82.62Q543.75,790.83,541,743.9c-1,0-1.92,0-2.9,0H256.29q-33.87,0-48.71-15t-14.84-48.54V295.58q0-22.33,6.63-36.49a41.18,41.18,0,0,1,20.78-20.6Q234.3,232,256.29,232H530.06q24.78,0,36.84,11t12,28.81q0,18.15-12,29.15t-36.84,11H296.45V437.7h215.1q23.74,0,35.44,10.65t11.7,28.11q0,17.48-11.52,28.46t-35.62,11H296.45V661.53H538.09q3.76,0,7.26.27a287.88,287.88,0,0,1,12.56-47.73q17.55-48.89,51.64-83t83-52.15q48.88-18.07,110.85-18.08,51,0,90.2,13.6t63.69,34.25q24.43,20.67,36.83,43.73t12.39,41q0,19.29-14.28,32.88a47.94,47.94,0,0,1-34.26,13.6,46.05,46.05,0,0,1-21.17-5.17,48,48,0,0,1-17-14.46q-18.93-29.6-32-44.75T852.42,550q-22.2-10.34-56.63-10.33-35.46,0-63.34,12.22a130.87,130.87,0,0,0-47.68,35.46q-19.8,23.24-30.3,57T644,719.07q0,88.81,40.8,136.67t113.77,47.85a231.88,231.88,0,0,0,66.62-9.3,337.73,337.73,0,0,0,63.17-26.51V785.85H849.15q-28.57,0-43.21-8.61T791.31,748q0-16.86,12.22-27.88t33.22-11h116q21.35,0,36.15,3.79a40.81,40.81,0,0,1,23.92,16.87Q1022,742.82,1022,769Z",transform:"translate(-186.74 -226.03)"})]}),"./MenuIcons/export.png":Object(d.jsxs)("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 841.24 898.25",width:"4vh",height:"4vh",children:[Object(d.jsx)("defs",{children:Object(d.jsx)("style",{children:e})}),Object(d.jsx)("path",{class:"cls-2",d:"M1020.62,789.78v249a40.18,40.18,0,0,1-40.18,40.17H219.56a40.18,40.18,0,0,1-40.18-40.17v-249a40.18,40.18,0,0,1,40.18-40.18h58.25A40.18,40.18,0,0,1,318,789.78V940.34H882V789.78a40.18,40.18,0,0,1,40.17-40.18h58.25A40.18,40.18,0,0,1,1020.62,789.78Z",transform:"translate(-179.38 -180.69)"}),Object(d.jsx)("path",{class:"cls-2",d:"M384.19,390.1,533.64,240.66l48.21-48.21a38.5,38.5,0,0,1,55.4,0l48.22,48.22L834.9,390.1a40.17,40.17,0,0,1,0,56.81L793.71,488.1a40.17,40.17,0,0,1-56.81,0L679,430.18V751.79A40.18,40.18,0,0,1,638.81,792H580.55a40.18,40.18,0,0,1-40.17-40.17V429.91L482.19,488.1a40.17,40.17,0,0,1-56.81,0l-41.19-41.19A40.17,40.17,0,0,1,384.19,390.1Z",transform:"translate(-179.38 -180.69)"}),Object(d.jsx)("path",{class:"cls-2",d:"M665.69,620.82a40.39,40.39,0,0,1-5.61,7L618.9,669a40.08,40.08,0,0,1-29.11,11.76A40,40,0,0,0,617.48,669Z",transform:"translate(-179.38 -180.69)"}),Object(d.jsx)("path",{class:"cls-2",d:"M589.79,680.79A40,40,0,0,1,560.67,669l-41.19-41.19a40.14,40.14,0,0,1-5.62-7L562.08,669A40,40,0,0,0,589.79,680.79Z",transform:"translate(-179.38 -180.69)"})]}),"./MenuIcons/import.png":Object(d.jsxs)("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 841.24 898.26",width:"4vh",height:"4vh",children:[Object(d.jsx)("defs",{children:Object(d.jsx)("style",{children:e})}),Object(d.jsx)("path",{class:"cls-2",d:"M1020.62,789.78v249a40.18,40.18,0,0,1-40.18,40.17H219.56a40.18,40.18,0,0,1-40.18-40.17v-249a40.18,40.18,0,0,1,40.18-40.18h58.25A40.18,40.18,0,0,1,318,789.78V940.34H882V789.78a40.18,40.18,0,0,1,40.17-40.18h58.25A40.18,40.18,0,0,1,1020.62,789.78Z",transform:"translate(-179.38 -180.68)"}),Object(d.jsx)("path",{class:"cls-2",d:"M834.91,582.54,685.46,732l-48.21,48.21a38.5,38.5,0,0,1-55.4,0L533.63,732,384.2,582.54a40.17,40.17,0,0,1,0-56.81l41.19-41.19a40.17,40.17,0,0,1,56.81,0l57.92,57.92V220.85a40.18,40.18,0,0,1,40.17-40.17h58.26a40.18,40.18,0,0,1,40.17,40.17V542.73l58.19-58.19a40.17,40.17,0,0,1,56.81,0l41.19,41.19A40.17,40.17,0,0,1,834.91,582.54Z",transform:"translate(-179.38 -180.68)"}),Object(d.jsx)("path",{class:"cls-2",d:"M665.69,620.82a40.39,40.39,0,0,1-5.61,7L618.9,669a40.08,40.08,0,0,1-29.11,11.76A40,40,0,0,0,617.48,669Z",transform:"translate(-179.38 -180.68)"}),Object(d.jsx)("path",{class:"cls-2",d:"M589.79,680.79A40,40,0,0,1,560.67,669l-41.19-41.19a40.14,40.14,0,0,1-5.62-7L562.08,669A40,40,0,0,0,589.79,680.79Z",transform:"translate(-179.38 -180.68)"})]})},i=(t.text,""===t.img?"100%":"70%"),a=(t.img,t.custom_style);return Object(d.jsxs)("div",{style:a,className:"menu-item ".concat(t.classString||""),onClick:t.onClick,"aria-label":t.label,children:[n[t.img],Object(d.jsx)("h4",{className:"menu-item-label",style:{fontSize:i},children:t.text})]})}var f=n(4),g=n.n(f);function v(t){var e={left:[{text:"",img:"./MenuIcons/logo.png",onClick:function(){window.open("https://github.com/eddiekrystowski/existential-graphs")},custom_style:{marginLeft:"0vw"}},{text:"Existential Graphs",img:"",onClick:function(){},custom_style:{marginLeft:"1vw"}},{text:"Import",img:"./MenuIcons/import.png",onClick:function(t){console.log("Importing...");var e=document.createElement("input");e.type="file",e.onchange=function(e){var n=e.target.files[0];if("application/json"===n.type){var i=new FileReader;i.readAsText(n,"UTF-8"),i.onload=function(e){var n=e.target.result;if(window.confirm("Erase your current workspace and import graph?")){t.clear();var i=JSON.parse(n);t.fromJSON(i)}}}else alert("File must be of .JSON type")},e.click()},custom_style:{marginLeft:"10vw"}},{text:"Export",img:"./MenuIcons/export.png",onClick:function(t){console.log("Exporting...");var e=t.toJSON(),n=new Blob([JSON.stringify(e)],{type:"application/json"}),i=document.createElement("a"),a=URL.createObjectURL(n);i.href=a,i.download="graph.json",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(a)}),0)},custom_style:{marginLeft:"5vw"}}],right:[{text:"Unmute",label:"Toggle Sound",classString:"mute-active",img:"./MenuIcons/export.png",onClick:t.handleMuteToggle,custom_style:{marginLeft:"5vw"}},{text:"Settings",img:"./MenuIcons/export.png",onClick:function(){},custom_style:{marginLeft:"5vw"}}]};return Object(d.jsxs)("div",{className:"header-bar",children:[Object(d.jsx)("div",{className:"header-bar-left",children:e.left.map((function(t){return Object(d.jsx)(p,{text:t.text,img:t.img,classString:t.classString,onClick:t.onClick,custom_style:t.custom_style,label:t.label},t.text)}))}),Object(d.jsx)("div",{className:"header-bar-right",children:e.right.map((function(t){return Object(d.jsx)(p,{text:t.text,img:t.img,classString:t.classString,onClick:t.onClick,custom_style:t.custom_style,label:t.label},t.text)}))})]})}n(78);var m=n(31),b=n(40),y=n(29),x=new(function(){function t(){Object(s.a)(this,t),this.mousePosition={x:0,y:0},this.keys=[],this.which=0,this.key="",this.isMouseDown=!1}return Object(o.a)(t,[{key:"isActive",value:function(t){return this.key.toLocaleLowerCase()===t||this.which===t||!0===this.keys[t]}}]),t}());g()(document).on("keydown",(function(t){x.keys[t.which]=!0,x.which=t.which,x.key=t.key})),g()(document).on("keyup",(function(t){x.keys[t.which]=!1,x.which=t.which,x.key=t.key})),g()(document).on("mousemove",(function(t){x.mousePosition={x:t.clientX,y:t.clientY}})),g()(document).on("mousedown",(function(t){x.isMouseDown=!0})),g()(document).on("mouseup",(function(t){x.isMouseDown=!1}));var j=x,C=n(6),k=n.n(C),O=n.p+"static/media/delete.775131a8.wav",w=n(19),_=n(24),M=n(63),P=n(37),A=n.p+"static/media/snip.6f2bc4d7.wav",E={background:{odd:{inactive:"#f2f8fc",active:"#f2f8fcE0"},even:{inactive:"#ffffff",active:"#ffffffE0"},default:{color:"#ffffff00"}}},S={position:{x:10,y:10},size:{width:40,height:40},attrs:{rect:{class:"cut_rect",width:40,height:40,fill:"#ffffff99",stroke:"black",strokeWidth:2},text:{class:"cut_text",fontSize:30,"ref-x":.5,"ref-y":.5,ref:"rect","y-alignment":"middle","x-alignment":"middle"}},graph:{}},B=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(){var t;Object(s.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).markup=[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],t}return Object(o.a)(n,[{key:"defaults",value:function(){return Object(m.a)(Object(m.a)({},Object(M.a)(Object(P.a)(n.prototype),"defaults",this)),{},{type:"dia.Element.Cut",attrs:{rect:S.attrs.rect,text:S.attrs.text}})}},{key:"create",value:function(t,e){var i=k.a.cloneDeep(S);if(t&&(i.position=Object.assign(i.position,t.position),i.size=Object.assign(i.size,t.size),i.attrs.rect=Object.assign(i.attrs.rect,t.attrs&&t.attrs.rect),i.attrs.text=Object.assign(i.attrs.text,t.attrs&&t.attrs.text)),i.sheet=e,t.child){var a=t.child;i.attrs.rect.width=a.attributes.attrs.rect.width+i.attrs.rect.width,i.attrs.rect.height=a.attributes.attrs.rect.height+i.attrs.rect.height,i.position={x:a.attributes.position.x-(i.attrs.rect.width-a.attributes.attrs.rect.width)/2,y:a.attributes.position.y-(i.attrs.rect.height-a.attributes.attrs.rect.height)/2}}var r=new n({markup:"<rect/><text/>",position:Object(m.a)({},i.position),size:Object(m.a)({},i.size),attrs:{rect:Object(m.a)({},i.attrs.rect),text:Object(m.a)({},i.attrs.text),level:0},sheet:i.sheet});if(r.sheet=i.sheet,r.addTo(r.sheet.graph),this.addTools(r),new Audio(A).play(),t&&t.child){var s=t.child,o=!1;if(s.get("parent")){var l=r.sheet.graph.getCell(s.get("parent"));l.unembed(s),l.embed(r),l.toBack(),o=!0}r.embed(s),o&&r.sheet.treeResize(r,r.attributes.attrs.rect.width/2)}return console.log(r),r}},{key:"destroy",value:function(){var t,e=this.getParentCell(),n=this.getEmbeddedCells(),i=Object(_.a)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.unembed(a)}}catch(r){i.e(r)}finally{i.f()}this.remove(),e&&this.sheet.handleCollisions(e),this.sheet.paper.handleDeleteCell()}},{key:"active",value:function(){this.sheet.colorByLevel(this,{even:E.background.even.active,odd:E.background.odd.active,premise:E.background.default.color})}},{key:"inactive",value:function(){this.sheet.colorByLevel(this,{even:E.background.even.inactive,odd:E.background.odd.inactive,premise:E.background.default.color})}},{key:"getBoundingBox",value:function(){return{width:this.attributes.attrs.rect.width,height:this.attributes.attrs.rect.height,x:this.attributes.position.x,y:this.attributes.position.y}}},{key:"getArea",value:function(){return this.attributes.attrs.rect.width*this.attributes.attrs.rect.height}},{key:"addTools",value:function(t){var e=t.findView(t.sheet.paper.jpaper);e.removeTools();var n=new y.g.Boundary,i=new y.g.Button(U({x:"0%",y:"0%",cursor:"nw-resize"})),a=new y.g.Button(U({x:"100%",y:"0%",cursor:"ne-resize"})),r=new y.g.Button(U({x:"0%",y:"100%",cursor:"sw-resize"})),s=new y.g.Button(U({x:"100%",y:"100%",cursor:"se-resize"}));g()(i.el).on("mousedown",z.bind(t)),g()(a.el).on("mousedown",z.bind(t)),g()(r.el).on("mousedown",z.bind(t)),g()(s.el).on("mousedown",z.bind(t));var o=[n,i,a,s,r],l=new y.f.ToolsView({tools:o});e.addTools(l),e.hideTools()}}]),n}(y.f.Element);Object.assign(r,{"dia.Element":{Cut:B}});var I={x:0,y:0},T={x:0,y:0},L=40,R=40;function z(t){var e=this.sheet.graph.getCell(g()(t.target).parent().attr("model-id"));I={x:t.clientX,y:t.clientY},g()(document).on("mouseup",{target:e},N),g()(document).on("mousemove",{target:e,direction:t.target.getAttribute("data-direction")},D),t.stopPropagation(),e.get("parent")&&this.sheet.graph.getCell(e.get("parent")).unembed(e)}function D(t){T={x:t.clientX,y:t.clientY};var e=t.data.target.attributes.attrs.rect.width,n=t.data.target.attributes.attrs.rect.height,i=t.data.target.attributes.position.x,a=t.data.target.attributes.position.y,r={x:T.x-I.x,y:T.y-I.y},s={size_x:1,size_y:1,pos_x:0,pos_y:0};switch(t.data.direction){case"nw":s.size_x=-1,s.size_y=-1,s.pos_x=1,s.pos_y=1;break;case"ne":s.size_x=1,s.size_y=-1,s.pos_x=0,s.pos_y=1;break;case"sw":s.size_x=-1,s.size_y=1,s.pos_x=1,s.pos_y=0;break;case"se":s.size_x=1,s.size_y=1,s.pos_x=0,s.pos_y=0;break;default:throw new RangeError("Invalid direction value. Expected nw, ne, sw, se. Got "+t.data.direction)}e+s.size_x*r.x<L&&(r.x=0),n+s.size_y*r.y<R&&(r.y=0),t.data.target.attr("rect/width",e+s.size_x*r.x),t.data.target.attr("rect/height",n+s.size_y*r.y),t.data.target.set("position",{x:i+s.pos_x*r.x,y:a+s.pos_y*r.y}),I=Object.assign({},T)}function N(t){g()(document).off("mouseup",N),g()(document).off("mousemove",D),t.data.target.sheet.handleCollisions(t.data.target)}function U(t){var e=t&&t.r||7,n=t&&t.fill||"transparent",i=t&&t.x||"0%",a=t&&t.y||"0%",r=t&&t.offset||{x:0,y:0},s=t&&t.cursor||"nw-resize";return{markup:[{tagName:"circle",selector:"button",attributes:{r:e,fill:n,cursor:s,"data-direction":s.substring(0,2)}}],x:i,y:a,offset:r,rotate:!0}}n(80);var q={position:{x:10,y:10},size:{width:40,height:40},attrs:{rect:{class:"premise_rect",width:40,height:40,fill:"#ffffff00",stroke:"black",strokeWidth:0},text:{class:"premise_text",text:"P",fontSize:50,"ref-x":.5,"ref-y":.5,ref:"rect","x-alignment":"middle","y-alignment":"middle"}},graph:{}},J=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(){var t;Object(s.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).markup=[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],t}return Object(o.a)(n,[{key:"defaults",value:function(){return Object(m.a)(Object(m.a)({},Object(M.a)(Object(P.a)(n.prototype),"defaults",this)),{},{type:"dia.Element.Premise",attrs:{rect:q.attrs.rect,text:q.attrs.text}})}},{key:"create",value:function(t,e,i){var a=k.a.cloneDeep(q);t&&(a.position=Object.assign(a.position,t.position),a.size=Object.assign(a.size,t.size),a.attrs.rect=Object.assign(a.attrs.rect,t.attrs&&t.attrs.rect),a.attrs.text=Object.assign(a.attrs.text,t.attrs&&t.attrs.text)),a.sheet=e;var r=new n({markup:'<g class="rotatable"><rect/><text/></g>',position:Object(m.a)({},a.position),size:Object(m.a)({},a.size),attrs:{rect:Object(m.a)({},a.attrs.rect),text:Object(m.a)({},a.attrs.text),level:0}});return r.sheet=a.sheet,r.addTo(r.sheet.graph),i||this.addTools(r),r}},{key:"destroy",value:function(){this.remove(),this.sheet.paper.handleDeleteCell()}},{key:"active",value:function(){}},{key:"inactive",value:function(){}},{key:"getBoundingBox",value:function(){return{width:this.attributes.attrs.rect.width,height:this.attributes.attrs.rect.height,x:this.attributes.position.x,y:this.attributes.position.y}}},{key:"getArea",value:function(){return this.attributes.attrs.rect.width*this.attributes.attrs.rect.height}},{key:"addTools",value:function(t){var e=t.findView(t.sheet.paper.jpaper);e.removeTools();var n=[new y.g.Boundary],i=new y.f.ToolsView({tools:n});e.addTools(i),e.hideTools()}}]),n}(y.f.Element);function H(t,e){var n=t.x,i=t.x+t.width,a=t.y,r=t.y+t.height,s=e.x,o=e.x+e.width,l=e.y,c=e.y+e.height;return n<s&&i>o&&a<l&&r>c}function V(t,e){var n,i=[],a=Object(_.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;t.id!==r.id&&(F(t.getBoundingBox(),r.getBoundingBox())&&i.push(r))}}catch(s){a.e(s)}finally{a.f()}return i}function F(t,e){return!(!H(t,e)&&!H(e,t))||!(t.y+t.height<e.y||e.y+e.height<t.y)&&!(t.x+t.width<e.x||e.x+e.width<t.x)}Object.assign(r.shapes,{"dia.Element":{Premise:J}});var K=n.p+"static/media/pop.cddf7df9.wav";function G(t,e){var n,i=Object(_.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t.id===a.id)return!0}}catch(r){i.e(r)}finally{i.f()}return!1}var Z=y.f.Element.define("nameSpace.Premise",J),X=y.f.Element.define("nameSpace.Cut",B),W={even:E.background.even.inactive,odd:E.background.odd.inactive,premise:E.background.default.color},Q=function(){function t(e){Object(s.a)(this,t),this.paper=e,this.handlePlayAudio=e.props.handlePlayAudio,this.graph=new y.f.Graph({},{cellNamespace:{nameSpace:{Premise:Z,Cut:X}}}),this.spacing=10}return Object(o.a)(t,[{key:"addPremise",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=(new J).create(t,this,n);this.handleCollisions(i);var a=new Audio(K);return this.handlePlayAudio(a),i}},{key:"addCut",value:function(t){var e=(new B).create(t,this);this.handleCollisions(e);var n=new Audio(A);return this.handlePlayAudio(n),e}},{key:"importCells",value:function(t){var e=this,n=t.map((function(t){return(t=t.clone()).sheet=e,t}));this.graph.resetCells(n);var i,a=Object(_.a)(n);try{for(a.s();!(i=a.n()).done;){var r=i.value;this.handleCollisions(r)}}catch(s){a.e(s)}finally{a.f()}}},{key:"exportAsJSON",value:function(){var t=this.graph.getCells().map((function(t){return Object.assign(t.attributes,{sheet:null})}));return JSON.stringify(t,null,2)}},{key:"importFromJSON",value:function(t){var e,n=JSON.parse(t),i=Object(_.a)(n);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=void 0;if("dia.Element.Premise"===a.type)r=this.addPremise(a,!0,!0);else{if("dia.Element.Cut"!==a.type)throw new RangeError("Cell type must be either dia.Element.Premise or dia.Element.Cut, got ".concat(a.type));r=this.addCut(a,!0,!0)}var s=g()('svg [model-id="'.concat(r.attributes.id,'"]'));s.trigger("mouseenter"),s.trigger("mouseleave")}}catch(o){i.e(o)}finally{i.f()}}},{key:"handleCollisions",value:function(t){console.log("=================== HANDLE COLLISIONS =========================");var e=t.getBoundingBox(),n=function(t){if(0!==t.length){var e,n=t[0].attributes.attrs.rect.width*t[0].attributes.attrs.rect.height,i=t[0],a=Object(_.a)(t);try{for(a.s();!(e=a.n()).done;){var r=e.value,s=r.attributes.attrs.rect.width*r.attributes.attrs.rect.height;s<n&&(n=s,i=r)}}catch(o){a.e(o)}finally{a.f()}return i}}(this.findPotentialParents(e));if(n){var i=this.filterChildren(n,e);n.embed(t);var a,r=Object(_.a)(i);try{for(r.s();!(a=r.n()).done;){var s=a.value;s.get("parent")&&n.unembed(s),t.embed(s)}}catch(u){r.e(u)}finally{r.f()}this.treeToFront(n)}else{var o,l=this.findElementsInside(e),c=Object(_.a)(l);try{for(c.s();!(o=c.n()).done;){var h=o.value;h.get("parent")||h.id===t.id||t.embed(h)}}catch(u){c.e(u)}finally{c.f()}this.treeToFront(t)}this.colorByLevel(t),this.pack(t),this.cleanOverlaps()}},{key:"pack",value:function(t){var e=this.findRoot(t);console.log("ROOT EMBEDS",e.getEmbeddedCells()),this.pack_rec(e)}},{key:"pack_rec",value:function(t){var e=t.getEmbeddedCells();if(console.log("siblings",e),0!==e.length){var n,i=Object(_.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.pack_rec(a)}}catch(o){i.e(o)}finally{i.f()}this.cleanOverlaps(e);var r=function(t){for(var e=t[0].attributes.position.x,n=t[0].attributes.attrs.rect.width+e,i=t[0].attributes.position.y,a=t[0].attributes.attrs.rect.height+i,r=1;r<t.length;r++){var s=t[r].getBoundingBox();s.x<e&&(e=s.x),s.y<i&&(i=s.y),s.x+s.width>n&&(n=s.x+s.width),s.y+s.height>a&&(a=s.y+s.height)}return{x:e,y:i,width:n-e,height:a-i}}(e),s=t.getBoundingBox();if(!H(s,r)){if(!F(s,r))return;(r.x<s.x||r.x+r.width>s.x+s.width)&&(t.position(r.x-this.spacing,t.attributes.position.y),t.attr("rect/width",r.width+2*this.spacing)),(r.y<s.y||r.y+r.height>s.y+s.height)&&(t.position(t.attributes.position.x,r.y-this.spacing),t.attr("rect/height",r.height+2*this.spacing))}}}},{key:"cleanOverlaps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCellsByLevel(0);t.sort((function(t,e){return e.getArea()-t.getArea()}));for(var e=t;e.length>0;){var n,i=[],a=Object(_.a)(e);try{for(a.s();!(n=a.n()).done;){var r,s=n.value,o=V(s,t),l=Object(_.a)(o);try{for(l.s();!(r=l.n()).done;){var c=r.value;this.separate(s,c);var h=G(c,i);h||i.push(c)}}catch(u){l.e(u)}finally{l.f()}}}catch(u){a.e(u)}finally{a.f()}e=i}}},{key:"separate",value:function(t,e){var n=t.getBoundingBox(),i=e.getBoundingBox(),a=n.x<i.x?n.x+n.width-i.x:n.x-i.x-i.width,r=n.y<i.y?n.y+n.height-i.y:n.y-i.y-i.height;if(Math.abs(a)>Math.abs(r)){var s=Math.sign(r);0===s&&(s=1),this.treeMove(e,{x:i.x,y:i.y+r+this.spacing*s})}else{var o=Math.sign(a);0===o&&(o=1),this.treeMove(e,{x:i.x+a+this.spacing*o,y:i.y})}}},{key:"getCellsByLevel",value:function(t){var e,n=this.graph.getCells(),i=[],a=Object(_.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value;r.attributes.attrs.level===t&&i.push(r)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"findElementsInside",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graph.getCells(),i=[],a=Object(_.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value,s=r.getBoundingBox();H(t,s)&&i.push(r)}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"findPotentialParents",value:function(t){var e,n=this.graph.getCells(),i=[],a=Object(_.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value;H(r.getBoundingBox(),t)&&i.push(r)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"filterChildren",value:function(t,e){var n,i=this.graph.getCells(),a=[],r=Object(_.a)(i);try{for(r.s();!(n=r.n()).done;){var s=n.value;s.get("parent")&&s.get("parent")!==t.id||a.push(s)}}catch(o){r.e(o)}finally{r.f()}return this.findElementsInside(e,a)}},{key:"treeToFront",value:function(t){for(var e=[t],n=[];e.length>0;){var i,a=Object(_.a)(e);try{for(a.s();!(i=a.n()).done;){var r,s=i.value;s.toFront();var o=s.getEmbeddedCells();(r=n).push.apply(r,Object(w.a)(o))}}catch(l){a.e(l)}finally{a.f()}e=n,n=[]}}},{key:"addSubgraph",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t[Object.keys(t)[0]],a=i.clone(),r=this.subgraphToGraph(i,a,t);return this.treeMove(r,e),n&&"dia.Element.Cut"===n.attributes.type&&n.embed(r),this.handleCollisions(r),a.id}},{key:"subgraphToGraph",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e.sheet=this,e.addTo(this.graph),null!=i&&i.embed(e);var a=t.get("embeds");if(a){var r,s=Object(_.a)(a);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=this.findCellInSubgraph(o,n);this.subgraphToGraph(l,l.clone(),n,e)}}catch(c){s.e(c)}finally{s.f()}}return e}},{key:"findCellInSubgraph",value:function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n++){var a=e[i[n]];if(a.id===t)return a}return alert("find subgraph failed!"),null}},{key:"treeResize",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.getParentCell();i;)i.attr("rect/width",i.attributes.attrs.rect.width+e),i.attr("rect/height",i.attributes.attrs.rect.height+e),n&&i.set("position",{x:i.attributes.position.x-e/2,y:i.attributes.position.y-e/2}),i=i.getParentCell()}},{key:"findRoot",value:function(t){for(;t.get("parent");)t=t.getParentCell();return t}},{key:"findLevel",value:function(t){for(var e=0,n=t.getParentCell();n;)e++,n=n.getParentCell();return e}},{key:"colorByLevel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=this.findRoot(t);if(n.attr("level",0),"dia.Element.Premise"!==n.attributes.type){n.attr("rect/fill",e.odd);for(var i=0,a=n.getEmbeddedCells();a.length>0;){var r,s=(++i+1)%2,o=[],l=Object(_.a)(a);try{for(l.s();!(r=l.n()).done;){var c=r.value;c.attr("level",i),"dia.Element.Premise"!==c.attributes.type?(c.attributes.attrs.level=i,0===s?c.attr("rect/fill",e.even):c.attr("rect/fill",e.odd),o.push.apply(o,Object(w.a)(c.getEmbeddedCells()))):c.attr("rect/fill",e.premise)}}catch(h){l.e(h)}finally{l.f()}a=o}}else n.attr("rect/fill",e.premise)}},{key:"treeMove",value:function(t,e){for(var n=e.x-t.attributes.position.x,i=e.y-t.attributes.position.y,a=[],r=[t];r.length>0;){a=r,r=[];var s,o=Object(_.a)(a);try{for(o.s();!(s=o.n()).done;){var l,c=s.value;(l=r).push.apply(l,Object(w.a)(c.getEmbeddedCells())),c.position(c.attributes.position.x+n,c.attributes.position.y+i)}}catch(h){o.e(h)}finally{o.f()}}}}]),t}(),Y=n(66),$=(n(86),function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).jpaper=null,i.sheet=new Q(Object(b.a)(i)),i}return Object(o.a)(n,[{key:"componentDidUpdate",value:function(t,e){this.props.num===this.props.total-1&&(this.sheet.importCells(this.props.cells),this.jpaper.scaleContentToFit())}},{key:"componentDidMount",value:function(){this.jpaper=new y.f.Paper({el:document.getElementById(this.props.id),model:this.sheet.graph,width:200,height:200,preventContextMenu:!1,clickThreshold:1}),this.sheet.importCells(this.props.cells),this.jpaper.scaleContentToFit(),this.jpaper.updateViews(),this.jpaper.setInteractivity(!1),g()("#".concat(this.props.id)).on("mouseover",(function(){g()(this).closest(".history-item").addClass("history-selected")})),g()("#".concat(this.props.id)).on("mouseout",(function(){g()(this).closest(".history-item").removeClass("history-selected")}))}},{key:"refresh",value:function(){}},{key:"render",value:function(){var t={backgroundColor:this.props.active?"#ed6b4d":""};return Object(d.jsx)("div",{class:"history-item",style:t,children:Object(d.jsx)("div",{id:this.props.id,class:"joint-paper history-item-paper",onClick:this.props.onClick})})}}]),n}(u.a.Component)),tt=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).handleJump=function(t){i.setState({index:t}),i.props.handleHistoryJump(i.getItem(t))},i.MAX_SIZE=1024,i.batch_mode=!1,i.batch_state=!1,i.locked=!1,i.state={data:[],index:0},i}return Object(o.a)(n,[{key:"clear",value:function(t){this.setState({data:[],index:0},t&&t)}},{key:"push",value:function(t){if(!this.locked)if(this.batch_mode)this.batch_state=t;else{var e=Object(w.a)(this.state.data);this.state.index!==this.state.data.length-1&&e.splice(this.state.index+1),e.push(t),e.length>=this.MAX_SIZE&&e.shift(),this.setState({data:e,index:e.length-1})}}},{key:"undo",value:function(){var t=this.state.index;return this.state.index>0&&(this.setState({index:this.state.index-1}),t-=1,this.getItem(t))}},{key:"redo",value:function(){var t=this.state.index;return this.state.index<this.state.data.length-1&&(this.setState({index:this.state.index+1}),t+=1,this.getItem(t))}},{key:"getItem",value:function(t){return this.state.data[t]}},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"startBatch",value:function(){this.batch_mode=!0,this.batch_state=null}},{key:"endBatch",value:function(){this.batch_mode=!1,null!==this.batch_state&&this.push(this.batch_state)}},{key:"render",value:function(){var t=this;return Object(d.jsx)("div",{class:"history",children:this.state.data.map((function(e,n){return 0===n?null:Object(d.jsx)($,{num:n,total:t.state.data.length,id:t.props.id_prefix+n,cells:e,active:t.state.index===n,onClick:t.handleJump.bind(t,n)},n)}))})}}]),n}(u.a.Component),et=(n(87),n(72),function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).handleChangeActive=function(t){i.setState({active:t===i.state.active?-1:t})},i.state={active:-1},i}return Object(o.a)(n,[{key:"render",value:function(){var t=this;return Object(d.jsx)("div",{class:"util-bar-root",children:u.a.Children.map(this.props.children,(function(e,n){return u.a.isValidElement(e)?u.a.cloneElement(e,{active:t.state.active===n,handleChangeActive:t.handleChangeActive.bind(t,n)}):e}))})}}]),n}(u.a.Component)),nt=function(t){return Object(d.jsxs)("div",{class:"util-bar-item-root",children:[Object(d.jsx)(Y.a,{icon:t.icon,className:"util-bar-item-icon",onClick:t.handleChangeActive}),Object(d.jsx)("div",{class:"util-bar-active-menu ".concat(!1===t.active?"visually-hidden":""),children:t.children})]})},it=n(67),at=4e3,rt=4e3,st=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).handleHistoryJump=function(t){i.history.current.lock(),i.sheet.importCells(t),i.history.current.unlock()},i.handleDeleteCell=function(){i.onGraphUpdate()},i.onClick=function(){console.log("clicked",Object(b.a)(i))},i.onKeyUp=function(t){t.keyCode===i.previousPremiseCode&&(i.canInsertPremise=!0)},i.onKeyDown=function(t){if("proof"!==i.getMode()){if("create"===i.getMode()&&j.keys[16]&&i.jpaper.setInteractivity(!1),8===t.keyCode){if(i.selected_premise){var e=new Audio(O);"dia.Element.Premise"===i.selected_premise.attributes.type||"dia.Element.Cut"===i.selected_premise.attributes.type?(i.selected_premise.destroy(),i.props.handlePlayAudio(e)):console.error("attempted to delete shape of unknown type: "+i.selected_premise.attributes.type)}i.selected_premise=null}var n=t.key.toLocaleUpperCase(),a=n.charCodeAt(0);if(i.canInsertPremise&&1===n.length&&!t.ctrlKey&&!t.metaKey&&a>=65&&a<=90){var r={attrs:{text:{text:n}},position:i.getRelativeMousePos()};i.sheet.addPremise(r),i.canInsertPremise=!1,i.previousPremiseCode=a}if(13===t.keyCode){var s={position:i.getRelativeMousePos()};if(i.selected_premise)s.child=i.selected_premise,i.sheet.addCut(s);else i.sheet.addCut(s)}if(49===t.keyCode&&i.selected_premise&&(i.saved_template=i.sheet.graph.cloneSubgraph([i.selected_premise],{deep:!0})),50===t.keyCode){var o=i.getRelativeMousePos();i.saved_template&&i.sheet.addSubgraph(i.saved_template,o,i.selected_premise)}}},i.onMouseDown=function(t){if(j.keys[16]&&"create"===i.getMode()){i.initial_cut_pos=Object.assign({},j.mousePosition),i.initial_cut_pos.x-=i.paper_element.getBoundingClientRect().left,i.initial_cut_pos.y-=i.paper_element.getBoundingClientRect().top;var e={position:Object.assign({},i.initial_cut_pos),size:{width:0,height:0}};i.history.current.lock(),i.temp_cut=i.sheet.addCut(e),i.temp_cut.active(),t.preventDefault()}},i.onMouseUp=function(){if("proof"===i.getMode()){if(i.history.current.startBatch(),!i.selected_premise&&i.props.action&&"insertDoubleCut"===i.props.action.name){var t=i.getRelativeMousePos();i.props.action(i.sheet,null,t),i.props.handleClearAction()}if(!i.selected_premise&&i.props.action&&"bound iterationend"===i.props.action.name){var e=i.getRelativeMousePos();i.props.action(i.sheet,null,e),i.props.handleClearAction()}i.history.current.endBatch()}if(i.temp_cut&&"create"===i.getMode()){var n=k.a.clone(i.temp_cut.get("position")),a=k.a.clone({width:i.temp_cut.attr("rect/width"),height:i.temp_cut.attr("rect/height")}),r={position:n,attrs:{rect:Object(m.a)({},a)}};i.temp_cut.remove(),i.history.current.unlock(),i.sheet.addCut(r)}i.jpaper.setInteractivity(!0),i.temp_cut=null},i.onMouseMove=function(){if("create"===i.getMode()&&j.isMouseDown&&j.keys[16]&&i.temp_cut){var t=i.getRelativeMousePos();i.temp_cut.set("position",{x:Math.min(t.x,i.initial_cut_pos.x),y:Math.min(t.y,i.initial_cut_pos.y)}),i.temp_cut.attr("rect/width",Math.abs(t.x-i.initial_cut_pos.x)),i.temp_cut.attr("rect/height",Math.abs(t.y-i.initial_cut_pos.y))}},i.onMouseEnter=function(){i.paper_element.focus()},i.sheet=new Q(Object(b.a)(i)),i.jpaper=null,i.paper_element=null,i.paperRoot=u.a.createRef(),i.selected_premise=null,i.saved_template=null,i.temp_cut=null,i.initial_cut_pos={x:0,y:0},i.canInsertPremise=!0,i.previousPremiseCode=0,i.state={show:!0},i.UtilBar=u.a.createRef(),i.history=u.a.createRef(),i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.jpaper=new y.f.Paper({el:document.getElementById(this.props.id),model:this.sheet.graph,width:at,height:rt,preventContextMenu:!1,clickThreshold:1}),this.paper_element=document.getElementById(this.props.id),this.setPaperEvents(),this.history.current.push(this.sheet.exportAsJSON())}},{key:"onGraphUpdate",value:function(){var t=this.sheet.graph.getCells();this.history.current.push(t)}},{key:"show",value:function(){g()(this.paperRoot.current).css("display","flex")}},{key:"hide",value:function(){g()(this.paperRoot.current).css("display","none")}},{key:"getMode",value:function(){return this.props.mode||"create"}},{key:"setupModalPaper",value:function(){this.sheet.graph.clear()}},{key:"copyFrom",value:function(t){for(var e=t.sheet.graph.getCells(),n=0;n<e.length;n++)e[n]=e[n].clone(),e[n].graph=this.sheet.graph;this.sheet.graph.addCells(e)}},{key:"setPaperEvents",value:function(){var t=this;this.jpaper.on("element:mouseenter",(function(e,n){var i=e.model;i.findView(t.jpaper).showTools(),i.attr("rect/stroke","red"),i.attr("text/fill","red"),t.selected_premise=i})),this.jpaper.on("element:mouseleave",(function(e,n){var i=e.model,a=i.findView(t.jpaper);a&&(a.hideTools(),i.attr("rect/stroke","black"),i.attr("text/fill","black"),t.selected_premise=void 0)})),this.jpaper.on("cell:pointerdown",(function(e,n,i,a){console.log(e);var r=e.model;console.log("cell",r),r.get("embeds")&&0!==r.get("embeds").length||r.toFront(),r.get("parent")&&t.sheet.graph.getCell(r.get("parent")).unembed(r),r.active(),t.sheet.treeToFront(t.sheet.findRoot(r))})),this.jpaper.on("cell:pointerup",(function(e,n,i,a){var r,s=e.model;t.sheet.handleCollisions(s),s.inactive(),t.props.action||t.onGraphUpdate(),t.props.action&&(r=t.props.action(t.sheet,s,t.getRelativeMousePos())),t.props.handleClearAction&&!r&&t.props.handleClearAction(),r&&t.props.handleActionChange(r),t.selected_premise=null})),this.sheet.graph.on("add",(function(){t.onGraphUpdate()})),g()(this.paperRoot.current).on("keydown",(function(e){if(90===e.keyCode&&(e.ctrlKey||e.metaKey)&&!e.shiftKey){var n=t.history.current.undo();n&&(t.history.current.lock(),t.sheet.importCells(n),t.history.current.unlock())}if(90===e.keyCode&&(e.ctrlKey||e.metaKey)&&e.shiftKey){var i=t.history.current.redo();i&&(t.history.current.lock(),t.sheet.importCells(i),t.history.current.unlock())}}))}},{key:"getRelativeMousePos",value:function(){return{x:j.mousePosition.x-this.paper_element.getBoundingClientRect().left,y:j.mousePosition.y-this.paper_element.getBoundingClientRect().top}}},{key:"render",value:function(){var t=this;if(!this.state.show)return null;var e={width:this.props.wrapperWidth||"100%",height:this.props.wrapperHeight||"100%"};return Object(d.jsxs)("div",{class:"paper-root",ref:this.paperRoot,children:[Object(d.jsx)("div",{class:"paper-wrapper",style:e,children:Object(d.jsx)("div",{id:this.props.id,class:"joint-paper",onClick:this.onClick,onKeyDown:function(e){return t.onKeyDown(e)},onKeyUp:function(e){return t.onKeyUp(e)},onMouseDown:function(e){return t.onMouseDown(e)},onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove,onMouseEnter:this.onMouseEnter,tabIndex:"0"})}),Object(d.jsx)(et,{ref:this.UtilBar,children:Object(d.jsx)(nt,{icon:it.a,children:Object(d.jsx)(tt,{ref:this.history,id_prefix:"".concat(this.props.id,"-"),handleHistoryJump:this.handleHistoryJump,handleInitializeHistory:this.handleInitializeHistory})})})]})}}]),n}(u.a.Component);n(88);var ot=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(){return Object(s.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(d.jsx)("button",{className:"button-group-button",onClick:this.props.onClick,children:this.props.text})}}]),n}(u.a.Component),lt=(n(89),function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(){return Object(s.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(d.jsx)("div",{className:"button-group",children:this.props.buttons.map((function(t){return Object(d.jsx)(ot,{text:t.text,onClick:t.onClick},t.text)}))})}}]),n}(u.a.Component)),ct=(n(90),function(t,e,n){if(console.log("ARGS",arguments),"Cut"!=e.__proto__.constructor.name||e.attributes.level%2!==0){console.log("opening modal...");var i=t.paper;i.props.handleOpenModal(n)}}),ht=function(t,e){if(console.log(e.attributes.attrs.level),e.attributes.attrs.level%2===0){var n=e.getEmbeddedCells({deep:!0}),i=t.graph.getCell(e.attributes.parent);e.destroy();for(var a=0;a<n.length;a++)n[a].destroy();i&&t.handleCollisions(i)}},ut=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={},a={};if(!e&&n)i=n,a={width:80,height:80};else{if(!e)throw new Error("Bad arguments");i=e.get("position"),a={width:e.attr("rect/width"),height:e.attr("rect/height")}}for(var r=[.8,.25],s=0;s<r.length;s++)t.addCut({position:{x:i.x-a.width*r[s]/2,y:i.y-a.height*r[s]/2},attrs:{rect:{width:a.width*(1+r[s]),height:a.height*(1+r[s])}}})},dt=function(t,e){var n;console.log("MODEL: ",e);var i=t.graph;if("Cut"===e.__proto__.constructor.name&&1===(null===(n=e.attributes.embeds)||void 0===n?void 0:n.length)&&"Cut"===i.getCell(e.attributes.embeds[0]).__proto__.constructor.name){var a=i.getCell(e.attributes.embeds[0]).attributes.embeds;i.getCell(e.attributes.embeds[0]).destroy(),e.destroy(),e.attributes.parent?t.handleCollisions(i.getCell(e.attributes.parent)):null===a||void 0===a||a.forEach((function(e){"Cut"===i.getCell(e).__proto__.constructor.name&&t.handleCollisions(i.getCell(e))}))}},pt=function(t,e){return ft.bind(null,e)},ft=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=e.graph.cloneSubgraph([t],{deep:!0}),r=e.addSubgraph(a,i,n);a=e.graph.getCell(r),bt(e,t,a)||mt(e,a)},gt=function(t,e){for(var n=e.id,i=e;i.attributes.parent;){if("Cut"!==(i=t.graph.getCell(i.attributes.parent)).__proto__.constructor.name)return void console.error("Parent is of type "+i.__proto__.constructor.name+". Expected Cut. Contact administrator.");var a=i.attributes.embeds;null===a||void 0===a||a.forEach((function(i){var a=t.graph.getCell(i);a.id!==n&&vt(t,e,a)&&mt(t,e)}))}var r=t.graph.attributes.cells.models;null===r||void 0===r||r.forEach((function(i){var a=t.graph.getCell(i);0===(null===a||void 0===a?void 0:a.attributes.attrs.level)&&(null===a||void 0===a?void 0:a.id)!==n&&vt(t,e,a)&&mt(t,e)}))};function vt(t,e,n){if(e.__proto__.constructor.name!==n.__proto__.constructor.name)return!1;if("Premise"===e.__proto__.constructor.name)return e.attributes.attrs.text.text===n.attributes.attrs.text.text;if("Cut"===e.__proto__.constructor.name){var i=Object(w.a)(e.attributes.embeds||[]),a=Object(w.a)(n.attributes.embeds||[]);if(!i&&!a)return!0;if(i.length!==a.length)return!1;t:for(;i.length>0;){for(var r=t.graph.getCell(i[0]),s=0;s<a.length;s++)if(vt(t,r,t.graph.getCell(a[s]))){i.shift(),a.splice(s,1);continue t}return!1}return!0}return console.error("Can not compare models of type "+e.__proto__.constructor.name+". Contact administrator"),!1}function mt(t,e){var n;if("Premise"===e.__proto__.constructor.name||0===(null===(n=e.attributes.embeds)||void 0===n?void 0:n.length))return e.destroy(),void console.log("ballse");e.attributes.embeds.forEach((function(e){mt(t,t.graph.getCell(e))})),e.destroy()}function bt(t,e,n){if(!vt(t,e,n))return console.error("Model discrepency when detecting legality of iteration."),!1;if(0===e.attributes.attrs.level)return!0;if(e.attributes.attrs.level>n.attributes.attrs.level)return!1;var i=Object(w.a)(t.graph.getCell(e.attributes.parent).attributes.embeds);for(i.splice(i.indexOf(e.id,1));i.length>0;){var a,r=i.shift();if(r===n.id)return!0;if("Cut"===t.graph.getCell(r).__proto__.constructor.name)null===(a=t.graph.getCell(r).attributes.embeds)||void 0===a||a.forEach((function(t){i.push(t)}))}return!1}var yt=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).state={buttons:{create:[{text:"Add Premise",onClick:function(){console.log("Adding premise...")}},{text:"Cut",onClick:function(){console.log("Cutting...")}}],proof:[{text:"Insertion",onClick:function(){i.props.handleActionChange(ct),console.log("Loading insertion into action...")}},{text:"Erasure",onClick:function(){i.props.handleActionChange(ht),console.log("Performing erasure...")}},{text:"Insert Double Cut",onClick:function(){i.props.handleActionChange(ut),console.log("Inserting double cut...")}},{text:"Delete Double Cut",onClick:function(){i.props.handleActionChange(dt),console.log("Deleting double cut...")}},{text:"Iteration",onClick:function(){i.props.handleActionChange(pt),console.log("Performing iteration...")}},{text:"Deiteration",onClick:function(){i.props.handleActionChange(gt),console.log("Performing deiteration...")}}]},color:{text:{create:"#E0FBFC",proof:"#293241"},background:{create:"#3D5A80",proof:"#98C1D9"}}},i}return Object(o.a)(n,[{key:"render",value:function(){return Object(d.jsx)("div",{className:"menu-bar",style:{backgroundColor:this.state.color.background[this.props.mode],color:this.state.color.text[this.props.mode]},children:Object(d.jsxs)("div",{id:"side-wrapper",children:[Object(d.jsxs)("h2",{children:[this.props.mode.charAt(0).toUpperCase()+this.props.mode.slice(1)," Mode"]}),Object(d.jsx)(ot,{text:"Switch Mode",onClick:this.props.onStateSwitch}),Object(d.jsx)(lt,{buttons:this.state.buttons[this.props.mode],mode:this.props.mode})]})})}}]),n}(u.a.Component),xt=(n(91),function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){return Object(s.a)(this,n),e.call(this,t)}return Object(o.a)(n,[{key:"render",value:function(){return this.props.show?(console.log("rendering..."),Object(d.jsx)("div",{class:"modal-bg",children:Object(d.jsxs)("div",{class:"modal-body",children:[Object(d.jsx)("div",{class:"modal-top-bar",children:this.props.buttons.map((function(t){return Object(d.jsx)("button",{class:"modal-item modal-item-".concat(t.name),onClick:t.onClick,children:t.text},t.name)}))}),Object(d.jsx)("div",{class:"modal-content",children:this.props.children})]})})):(console.log("early"),null)}}]),n}(u.a.Component)),jt=(n(92),new Event("load-modal"),function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).handleActionChange=function(t){i.setState({action:t})},i.handleModalExit=function(){i.setState({showModal:!1})},i.handleOpenModal=function(t){i.setState({showModal:!0}),i.insertPosition=Object.assign({},t)},i.handleModalInsert=function(t){console.log("inserting..."),i.proofPaper.current.sheet.importFromJSON(i.modalPaper.current.sheet.exportAsJSON()),i.handleModalExit()},i.state={mode:"create",action:null,showModal:!1},i.insertPosition={x:0,y:0},i.modalPaper=u.a.createRef(),i.mainPaper=u.a.createRef(),i.proofPaper=u.a.createRef(),i.history=[],i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.proofPaper.current.hide(),this.proofPaper.current.history.current.clear()}},{key:"componentDidUpdate",value:function(t,e){if(e.mode!==this.state.mode)if("proof"===this.state.mode){this.mainPaper.current.hide(),this.proofPaper.current.sheet.graph.clear();var n=this.mainPaper.current.sheet.exportAsJSON();this.proofPaper.current.sheet.importFromJSON(n),this.proofPaper.current.show()}else this.mainPaper.current.show(),this.proofPaper.current.hide(),this.proofPaper.current.history.current.clear()}},{key:"handleStateSwitch",value:function(){this.setState({mode:"create"===this.state.mode?"proof":"create"})}},{key:"handleClearAction",value:function(){this.handleActionChange(null)}},{key:"render",value:function(){var t=[{name:"insert",text:"Insert",onClick:this.handleModalInsert},{name:"cancel",text:"X",onClick:this.handleModalExit}];return Object(d.jsxs)("div",{class:"workspace",children:[Object(d.jsx)(yt,{mode:this.state.mode,onStateSwitch:this.handleStateSwitch.bind(this),handleActionChange:this.handleActionChange.bind(this)}),Object(d.jsx)(st,{id:this.props.paper_id,mode:this.state.mode,action:this.state.action,handleClearAction:this.handleClearAction.bind(this),handleActionChange:this.handleActionChange,handleOpenModal:this.handleOpenModal,handlePlayAudio:this.props.handlePlayAudio,ref:this.mainPaper}),Object(d.jsx)(st,{id:this.props.paper_id+"-proof-paper",mode:this.state.mode,action:this.state.action,handleClearAction:this.handleClearAction.bind(this),handleActionChange:this.handleActionChange,handleOpenModal:this.handleOpenModal,handlePlayAudio:this.props.handlePlayAudio,ref:this.proofPaper}),Object(d.jsx)(xt,{show:this.state.showModal,buttons:t,children:Object(d.jsx)(st,{id:this.props.paper_id+"-modal-paper",mode:"create",action:null,handleClearAction:null,handleActionChange:null,handleOpenModal:null,handlePlayAudio:this.props.handlePlayAudio,wrapperWidth:"100%",wrapperHeight:"72vh",ref:this.modalPaper})})]})}}]),n}(u.a.Component)),Ct=function(t){Object(l.a)(n,t);var e=Object(c.a)(n);function n(t){var i;return Object(s.a)(this,n),(i=e.call(this,t)).handleMuteToggle=function(){i.setState({muted:!i.state.muted});var t,e=(t="Toggle Sound",g()(".header-bar").find('[aria-label="'.concat(t,'"]'))),n=e.find(".menu-item-label");e.toggleClass("mute-active"),e.hasClass("mute-active")?n.html("Unmute"):n.html("Mute")},i.handlePlayAudio=function(t){i.state.muted||(i.sound=t,i.sound.play())},i.workspace=u.a.createRef(),i.sound=null,i.state={muted:!0},i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){console.log("WORKSPACE",this.workspace)}},{key:"componentDidUpdate",value:function(t,e){this.state.muted&&this.sound&&(this.sound.pause(),this.sound.currentTime=0)}},{key:"render",value:function(){return Object(d.jsxs)("div",{id:"app",className:"app",children:[Object(d.jsx)(v,{id:"header",muted:this.state.muted,handleMuteToggle:this.handleMuteToggle}),Object(d.jsx)(jt,{paper_id:"main-paper",ref:this.workspace,handlePlayAudio:this.handlePlayAudio})]})}}]),n}(u.a.Component);console.log("Starting..."),window.joint=r,window.action=null,window.mode="create";var kt=a.a.render(Object(d.jsx)(Ct,{}),document.getElementById("root"));console.log(kt),console.log(kt.workspace)}},[[94,1,2]]]);
//# sourceMappingURL=main.f4ea5f04.chunk.js.map